CREATE TABLE API_REQUEST_LOG (
  ID            NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  TARGET_TABLE  VARCHAR2(128)  NOT NULL,  
  REQUEST_SRC   VARCHAR2(128),            
  STATUS        VARCHAR2(32),             
  CREATED_AT    TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL
);

CREATE INDEX IX_ARL_TARGET_TIME ON API_REQUEST_LOG (TARGET_TABLE, CREATED_AT);
CREATE INDEX IX_ARL_STATUS      ON API_REQUEST_LOG (STATUS);

CREATE OR REPLACE VIEW V_API_REQUEST_COUNTS_DAILY AS
SELECT
  TARGET_TABLE,
  TRUNC(CREATED_AT) AS DAY,
  COUNT(*)          AS REQ_COUNT
FROM API_REQUEST_LOG
GROUP BY TARGET_TABLE, TRUNC(CREATED_AT);
